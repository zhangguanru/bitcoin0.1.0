
## 挖矿的流程

BitcoinMiner函数作为入口阅读源码

### 大致流程
生成coinbase接收的地址；根据上一个区块得到挖矿难度；
构造coinbase交易并作为交易集合的第一个元素；
遍历内存池中的交易；判断每笔交易的输入是否合法；将合法交易放入交易集合中；
统计coinbase交易的收益 挖矿奖励+交易手续费；
从交易集合中构造MerkleTree；
调整nonce，计算区块的哈希；
如果满足条件；则将区块信息写进磁盘。



### 验证交易输入是否合法
coinbase交易没有输入，不进行检测；
遍历交易的每一个输入；
根据交易输入的txid，从内存或者磁盘上查询出上笔交易；
如果输入的txid是coinbase交易，检查它是否已经可花费；
验证交易的签名：
    用脚本验证交易是否合法 解锁脚本+锁定脚本；
检查交易输入是否已经被花费；
检查交易输出是否大于交易输入